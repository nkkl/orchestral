<p id="notice"><%= notice %></p>

<h1>These are the musicians in this orchestra</h1>

<%= content_tag "div", id: "orchestra", data: {url: root_url} do %><% end %>

<table>
  <thead>
    <tr>
      <th>Instrument</th>
      <th>Sponsored?</th>
      <th>Sponsor</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @musicians.each do |musician| %>
      <tr>
        <td><%= musician.instrument %></td>
        <td><%= musician.status %></td>
        <td><%= musician.sponsor %></td>
        <% if musician.status != true %>
          <td class="<%= musician.id %>"><button class="sponsor">sponsor</button></td>
        <% end %>

      </tr>
    <% end %>
  </tbody>
</table>

<div id="checkout">
  <div class="close-button">&times;</div>

  <form id="checkout-form" method="post" action="/checkout">
    <div id="details">
      <input type="text" name="donorname" placeholder="name">
      <input type="email" name="donoremail" placeholder="email address" required> 
    </div>
    <div id="payment-form"></div>
    <button type="submit">Donate $50</button>
    <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
    <input type="hidden" id="id-field" name="id" value="">
  </form>
</div>

<br>

<div id="lightbox"></div>

<script src="https://js.braintreegateway.com/v2/braintree.js"></script>
<script type="text/javascript">

  // fetches client token from server
  braintree.setup('<%= @client_token %>', "dropin", {
    container: "payment-form"
  });


  var musicians = $.getJSON( $('#orchestra').data('url' + '.json'), function() { 
    renderMusicians(musicians.responseJSON);
  });

  // bind clicks to open payment modal
  $('.sponsor').click( function() {
    $('#checkout').show();

    // block interaction on the rest of the screen
    $('#lightbox').show();
    $('html, body').css('overflow', 'hidden');

    // add id to form so that we can update the correct musician in the database 
    var id =  $($(this).parent()[0]).attr('class');
    $('#id-field').val(id);
  });

  // bind clicks to close payment modal
  $('#checkout .close-button').click(function() {
      $('#lightbox').hide();
      $('html, body').css('overflow', 'auto');
      $('#checkout').hide();
  });
</script>